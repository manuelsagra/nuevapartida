function bind(e,a){return function(){return a.apply(e,arguments)}}function debounce(e,a){var t;return function(){var o=arguments;t&&clearTimeout(t),t=setTimeout(bind(this,function(){e.apply(this,o)}),a)}}function showLoading(){$('<div id="overlay"></div>').appendTo("body").fadeIn("fast")}function hideLoading(){$("#overlay").fadeOut("slow",function(){$(this).remove()})}function updateYears(){$("#yearFrom").val($("#yearsSlider>div").slider("values",0)),$("#yearTo").val($("#yearsSlider>div").slider("values",1))}function searchRaw(){var e={type:$("#type").val(),s:$("#s").val(),code:$("#code").val(),from:$("#yearFrom").val(),to:$("#yearTo").val()};$(".combo").each(function(a,t){e[t.id]=t.value}),showLoading(),$.ajax({url:BASE_URL+"search.php",data:e,success:function(e){p=0,d=e,$(".content").html('<section class="portlet results"><header><h1>Resultados</h1></header><div class="charts clearfix"></div><footer></footer></section>'),$("#results").html('<ul class="items clearfix"></ul>'),loadData()},error:function(){alert("ERROR")}})}function loadCombo(e){$.ajax({url:BASE_URL+"combo.php",data:{c:e},cache:!0,success:function(a){if($("#"+e+" option.loading").remove(),a&&a.length>0)if(a[0].g){for(var t="",o="",n=0;n<a.length;n++){var i=a[n];t!=i.g&&(o+=(""!=o?"</optgroup>":"")+'<optgroup label="'+i.g+'">'),o+='<option value="'+i.i+'">'+i.n+"</option>",t=i.g}$("#"+e).append(o+"</optgroup>")}else $.each(a,function(a,t){$("#"+e).append('<option value="'+t.i+'">'+t.n+"</option>")})},error:function(){$("#"+e+" option.loading").text("Error cargando valores")}})}function loadData(){google&&google.load("visualization","1.0",{packages:["corechart"],callback:function(){showCharts(),showResults(),hideLoading()}})}function showCharts(){if($(".portlet footer").html(d.results.length+" resultado"+(1!=d.results.length?"s":"")),d.years){if($(".charts").append('<div id="years"></div><div id="platforms"></div><div id="regions"></div><div id="genres"></div>'),d.years){var e=getDataTable(d.years,"Año","Lanzamientos"),a=new google.visualization.LineChart(document.getElementById("years"));a.draw(e,{legend:"none",curveType:"function",width:400,height:200,title:"Distribución por años",vAxis:{viewWindowMode:"explicit",viewWindow:{min:0},format:"###",gridlines:{count:2}}})}if(d.platforms){var e=getDataTable(d.platforms,"Plataforma","Lanzamientos"),a=new google.visualization.PieChart(document.getElementById("platforms"));a.draw(e,{legend:"none",curveType:"function",width:200,height:200,title:"Distribución por plataformas"})}if(d.regions){var e=getDataTable(d.regions,"Región","Lanzamientos"),a=new google.visualization.PieChart(document.getElementById("regions"));a.draw(e,{legend:"none",curveType:"function",width:200,height:200,title:"Distribución por regiones"})}if(d.genres){var e=getDataTable(d.genres,"Género","Lanzamientos"),a=new google.visualization.PieChart(document.getElementById("genres"));a.draw(e,{legend:"none",curveType:"function",width:200,height:200,title:"Distribución por géneros"})}}}function getDataTable(e,a,t){var o=new google.visualization.DataTable;o.addColumn("string",a),o.addColumn("number",t);var n=[];return $.each(e,function(e,a){n.push([e,a])}),o.addRows(n),o}function showResults(){for(var e="",a=p+40,t=p;t<d.results.length&&a>t;){var o=d.results[t];e+='<li style="display: none"><a href="'+BASE_URL+d.type+"/"+o.i+'" style="background-image:url('+BASE_URL+"getItemImg.php?id="+o.i+')"><span>'+o.n+"</span></a></li>",t++}p=t,$("a.more").remove(),p<d.results.length&&($("ul.items").after('<a href="#" class="more">Mostrar más</a>'),$("a.more").click(function(e){e.preventDefault(),showResults()})),$(".items").append(e),$(".items li:hidden").fadeIn("fast")}var search=debounce(searchRaw,1e3),d,p;$(document).ready(function(){var e=1988,a=2008;$("#yearsSlider>div").slider({range:!0,values:[e,a],min:e,max:a,stop:function(){search()},slide:function(e,a){$("#yearFrom").val(a.values[0]),$("#yearTo").val(a.values[1])}}),$("#yearFrom").val(e),$("#yearTo").val(a),$(".text").keyup(function(){search()}),$("select.combo").change(function(){search()}),$(".year input").change(function(){search();var t=$("#yearFrom").val(),o=$("#yearTo").val();if((isNaN(parseInt(t))||!isFinite(t)||parseInt(t)<e)&&(t=e),(isNaN(parseInt(o))||!isFinite(o)||parseInt(o)>a)&&(o=a),t>o){var n=o;o=t,t=n}$("#yearFrom").val(t),$("#yearTo").val(o),$("#yearsSlider>div").slider("values",[t,o])}),$("#s").length>0&&searchRaw(),$("select.combo").each(function(e,a){loadCombo(a.id)})});
